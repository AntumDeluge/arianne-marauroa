<p>
<b>Title  :</b> Message Types<br>
<b>Info   :</b> Description of the different types of messages, its structure and use.<br>
<b>Keyword:</b> Message, Login, Logout, Character, chooseCharacter, ACK, NACK, Action,
            Map, MapHash, Perception<br>
<b>Author :</b> Miguel Angel Blanch Lardin<br>
<b>Created:</b> 2003/09/11<br>
<b>status :</b> planning<p>

To communicate client and server marauroa uses a stream of UDP packets.<br>
Message system belongs to marauroa.net package, so refer to code.<p>

The main idea is that messages has side, so we have Client to Server aka C2S 
and Server to Client aka S2C messages. Most of the messages have two versions:
C2S and S2C.<p>

The idea of communication that we need to model is:
<pre>
Client				Server
------				------
--onConnect:
Send Login			
				If Login is correct 
 			  	  Send LoginACK
				else
			    	  Send LoginNACK
			  	  Finish

				Send CharacterList

Send ChooseCharacter
				If character is correct
				  Send ChooseCharacterACK
				else
				  Send ChooseCharacterNACK
				  Finish

--onTimer:
Send Map Hash
					
				Send Perception
				Send Map

--onEvent:
Send Action
				Send ActionACK

--onExit:
Send Logout
				If client can logout
				  Send Logout ACK
				else
				  Send Logout NACK
			
</pre>

Let's detail each message type now.<p>


<b>Message C2S Login</b><br>
The login Message is sent from client to server to request rights to access
to the game.<p>
The message is composed by:<ul>
<li>username</li>
<li>password</li>
</ul>

Username is a string that is already registered on server as the name of an
user account, and password is a string that is associated with that account.<p>

If the username/password combination is correct then Server must send a Login
ACK Message to indicate the client that the message has been correctly 
processed. On the contrary, if the username/password is wrong the server will
send a Login NACK.<p>



<b>Message S2C LoginACK</b><br>
The LoginACK Message is sent from server to client to indicate that the login
process has been completed correctly and that it will procced with the next 
step.<br>
It has no params.<p>


<b>Message S2C LoginNACK</b><br>
The LoginNACK Message is sent from server to client to indicate client that its
login message is incorrect because either username or password is wrong or 
because server has decided to reject it, mainly because it is full or because 
the IP is banned.<p>

The message is composed by:<ul>
<li>Message indicating the resolution.</li>
</ul>

<b>Message S2C CharacterList</b><br>
The CharacterList Message is sent from server to client to inform client about
the possible election of character to play with. This feature models the 
behaviuor of having several characters associated with a single account.<p>

The message is composed by:<ul>
<li>A List of Character names</li>
</ul>

Each character name must be unique at server level, and it is assigned when the
character is created.<p>


<b>Message C2S ChooseCharacter</b><br>
The ChooseCharacter Message is sent from client to server to tell server what
character to choose to play the game.<p>

The message is composed by:<ul>
<li>the name of the character</li>
</ul>

The name of the character must be one of the listed on CharacterList Message or
the server will reply with a ChooseCharacter NACK message. Once the character 
has been choosen client is ready to start the game.<p>

The server will reply this message with a ChooseCharacter ACK or a 
ChooseCharacter NACK message. The client must have alredy log in before reciving 
this message, if this is violated the server will send a ChooseCharacterNACK.<p>

Once a character is chosen, the only way to choose a new one is by logging out 
and logging in.<p>


<b>Message S2C ChooseCharacter ACK</b><br>
The ChooseCharacter ACK Message is sent from server to client to notify the 
client that the character has been choosen.<br>
It has no params.<p>


<b>Message S2C ChooseCharacter NACK</b><br>
The ChooseCharacter NACK Message is sent from server to client to notify the 
client that the character has not been choosen, and so it requiere from client
that it send again a ChooseCharacter Message.<br>
It has no params.<p>


<b>Message C2S Logout</b><br>
The Logout Message is sent from client to server to indicate that it wants to 
finish the session.<br>
It has no params.<p>

If the client can logout the server will send a Logout ACK Message and the 
client can safely close the connection, but if server sends a Logout NACK
Message, client should keep playing as disconnecting in that moment will
let its avatar in the game uncontrolled ( idle ).<p>

<b>Message S2C Logout ACK</b><br>
The Logout ACK Message is sent from server to client to notify the 
client that the character has been choosen.<br>
It has no params.<p>


<b>Message S2C Logout NACK</b><br>
The Logout NACK Message is sent from server to client to notify the 
client that the character has not been choosen, and so it requiere from client
that it send again a ChooseCharacter Message.<br>
It has no params.<p>


<b>Message C2S Map Hash</b><br><p>

<b>Message S2C Map</b><br><p>

<b>Message S2C Perception</b><br><p>

<b>Message C2S Action</b><br><p>

<b>Message S2C Action ACK</b><br><p>

